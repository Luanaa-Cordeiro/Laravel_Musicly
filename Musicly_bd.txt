CREATE TABLE `sessions` (
    `id` VARCHAR(255) NOT NULL,
    `payload` TEXT NOT NULL,
    `last_activity` INTEGER(10) UNSIGNED NOT NULL,
    PRIMARY KEY (`id`)
);

ALTER TABLE `sessions`
ADD COLUMN `user_id` INT(10) UNSIGNED DEFAULT NULL;

ALTER TABLE `sessions`
ADD COLUMN `ip_address` VARCHAR(45) DEFAULT NULL;

ALTER TABLE `sessions`
ADD COLUMN `user_agent` TEXT DEFAULT NULL;


CREATE TABLE artistas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL UNIQUE
);

ALTER TABLE artistas
ADD COLUMN created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;


CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) UNIQUE NOT NULL,
    senha VARCHAR(100) NOT NULL
);

INSERT INTO users (nome, senha) VALUES
('João Silva', 'senha123'),
('Maria Oliveira', 'senha456'),
('Carlos Santos', 'senha789');

CREATE TABLE generos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) UNIQUE NOT NULL
);

INSERT INTO generos (nome) VALUES
('pop'),
('rock'),
('rap');

ALTER TABLE generos
ADD COLUMN created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;


CREATE TABLE albums( 
  `id` INT AUTO_INCREMENT,
  `nome` VARCHAR(45) NOT NULL,
  `data_lanc` DATE NOT NULL,
  `id_artista` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE (`nome`),
  FOREIGN KEY (`id_artista`)
    REFERENCES `musicly`.`artistas` (`id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION
) ENGINE = InnoDB;

SELECT a.id, a.nome AS nome, ar.nome AS artista
FROM albums AS a JOIN artistas AS ar ON a.id_artista = ar.id;

CREATE TABLE musicas (
  `id` INT AUTO_INCREMENT,
  `nome` VARCHAR(45) NOT NULL,
  `id_artista` INT NOT NULL,
  `id_album` INT NOT NULL,
  `id_genero` INT NOT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`id_artista`)
    REFERENCES `musicly`.`artistas` (`id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  FOREIGN KEY (`id_album`)
    REFERENCES `musicly`.`albums` (`id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  FOREIGN KEY (`id_genero`)
    REFERENCES `musicly`.`generos` (`id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  UNIQUE (`nome`)
) ENGINE = InnoDB;


SELECT m.id, m.nome, ar.nome as Artista, a.nome as Álbum, g.nome as Gênero from musicas as m join artistas as ar on m.id_artista = ar.id join albums as a on m.id_album = a.id join generos as g on m.id_genero = g.id;